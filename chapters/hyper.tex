\chapter{The HyPer Main Memory Database}\label{chapter:hyper}
In this chapter, the relational main memory database system HyPer~\parencite{5767867} is introduced. HyPer is a database system combining both OLTP and OLAP processing and is the main research subject of this work: Extending HyPer in order to execute data mining algorithms directly in the relational database.

\section{Motivation}

As already mentioned, historically databases are disk-based systems separated into two parts: An Online Transactional Processing (OLTP) system, optimized for high rates of mission-critical, transactional write requests, and an Online Analytical Processing (OLAP) system, executing long-running queries. The data synchronization is ensured by an ETL process that extracts, transforms and loads data from the OLTP to the OLAP system, which is usually done periodically. 
\\
Obviously, this architecture reveals several drawbacks. The periodical execution of the ETL process results in stale data on the OLAP system, e.g. when implementing a nightly ETL process, data can be outdated for up to 24 hours which is problematic for real-time data analysis. Furthermore, two systems lead to higher costs: Hardware and software costs must be taken into account as well as maintenance and incident management. Additionally, implementing an ETL process can make the two systems overly complex in contrast of having one system.
\\
Addressing these challenges the Hybrid OLTP \& OLAP High-Performance Database System (HyPer) was developed, with the goal to process OLTP transactions with high performance and throughput, and, on the same system, process OLAP queries on up-to-date data. 

\section{The HyPer Architecture}
In this section we give an overview about the HyPer system architecture and important design decisions. The argumentation in this section is based on~\parencite{5767867}. 

\subsection{High-Throughput OLTP Processing}
HyPer achieves major performance gains by omitting typical disk-based database characteristics that are not necessary anymore when data resides in main memory. For example, database-specific buffer management and page structuring is not needed. Instead, data is stored in main memory optimized data structures within the virtual memory. Hence, HyPer can use the highly efficient address-translation of the operating system without any additional indirection.
\\
Historically, OLTP transactions are suffering from slow disk access and I/O time caused by disk-based database systems. Therefore, OLTP transactions are executed in parallel to exploit the waiting time and to enhance the performance of the system.
In contrast, OLTP processing on HyPer is very fast because all the data is already loaded into main memory and slow disk access is omitted and not a bottleneck anymore. Therefore, transactions do not have to wait for I/O and HyPer can implement OLTP transactions as a single-threaded approach and executes all transactions sequentially. This is possible because the execution time of an OLTP transaction is in microseconds and even without parallel execution of transactions, a high-throughput is achievable.~\parencite{brawnywimpy} shows that 100,000 TPC-C transactions per second are possible. Another advantage of this simple model is that locking and latching of data objects becomes redundant since only one transaction is active for the entire database. 
\\
Even though HyPer achieves a high-throughput with sequential execution, these constraints can be relaxed when the database tables are partitioned. An example is multi-tenancy~\parencite{mt1}~\parencite{mt2}: Several clients are using the database, but do not have access to the data of the other clients. Then, the OLTP transactions can be executed in multiple threads to exploit the multi core database hardware. Still, no locking and latching is necessary since all transactions are executed sequentially within a partition.

\subsection{Long-Running OLAP Queries}

Obviously, this sequential execution of transactions is only possible if there are not any long-running transactions. Long-running transactions would be a bottleneck for the entire database and all following queries have to wait until its termination. Therefore this section discusses how HyPer implements OLAP queries on up-to-date data without negatively affecting the OLTP transaction performance. 
\\
HyPer considers OLAP queries as a new process and creates a snapshot of the virtual memory of the OLTP process for its OLAP processes. In Unix-based systems, this is done by~\texttt{forking} the OLTP process and creating a~\texttt{child} process for the OLAP process, exploiting the virtual memory functionality of the operating system. The OLAP process takes an exact copy of the OLTP system on process creation and is now able to execute long running queries without interfering the OLTP transaction throughput. Thanks to modern operating systems the creation of snapshots is very efficient because the memory segments are not physically copied. Instead, operating systems apply a \texttt{copy-on-update} strategy. That means that both OLTP and OLAP processes are sharing the same physical main memory location since their virtual address translation maps to the same segments. Therefore copying memory on creation is not necessary. Only if an object gets updated by the OLTP process, a new page has to be created for the OLTP process, while the OLAP virtual memory page is still the one available when the process was created. Since this mechanism is supported by hardware, it is very fast and efficient without any implementation overhead for the HyPer database system. Experiments have shown that a \texttt{fork} can be achieved in several milliseconds, which is almost independent of the size of the OLTP system.
\\
Since OLAP queries are read-only HyPer can execute them in parallel in multiple threads sharing the same snapshot. As in the sequential execution, locking and latching is not necessary because the used data structures are immutable. This inter-query parallelization can tremendously speed up query processing on multi core computers. Another approach is the creation of multiple OLAP session by forking the OLTP memory periodically. Therefore, for each OLAP session a new virtual memory snapshot is created and used as the current snapshot for the new session. This allows parallelization not only as inter-query parallelization but also among the different OLAP sessions.
\\ 
\\
In this chapter we have shown the advantages of a modern main memory system such as HyPer. Without the bottleneck of disk I/O, database operations can be run sequentially with up to 100,000 TPC-C transactions per second. OLAP queries can run very efficiently in parallel to the OLTP transaction system on different virtual memory snapshots with access to up-to-date data. 
\\
With these promising results for OLTP and OLAP processing, the next step is to extend HyPer by data mining functionalities. Then, HyPer provides even more possibilities for efficient, real-time data analysis on a running transactional database. In Chapter~\ref{chapter:implementation} we discuss these implementations of data mining algorithms, including how HyPer implements operators in general using the~\texttt{consume produce} programming model and LLVM code generation. 



